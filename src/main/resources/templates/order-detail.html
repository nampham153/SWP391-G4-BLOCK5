<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Chi tiết order</title>
    <link rel="stylesheet" th:href="@{/css/order-detail.css}">
</head>
<body>

<!-- Sidebars -->
<div sec:authorize="hasAuthority('MANAGER')"
     th:replace="~{taskbar/manager-taskbar :: managerTaskbar}"></div>
<div sec:authorize="hasAuthority('STAFF')"
     th:replace="~{taskbar/staff-taskbar :: staffTaskbar}"></div>

<!-- Derive base if the controller didn’t set it -->
<div th:with="b=${base != null ? base : (#strings.startsWith(#httpServletRequest.requestURI, '/admin') ? '/admin' : '/staff')}">

    <!-- Navigation Bar -->
    <nav class="navbar">
        <ul>
            <li><a th:href="@{${b}}">Home</a></li>
            <li><a th:href="@{${b} + '/orders'}">Orders</a></li>
        </ul>
    </nav>

    <div class="container">
        <!-- Alerts -->
        <div th:if="${message}" class="alert alert-success">[[${message}]]</div>
        <div th:if="${error}" class="alert alert-error">[[${error}]]</div>

        <div class="detail-container">
            <!-- Icon + number -->
            <div class="order-icon-section">
                <div class="order-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M19 7h-3V6a4 4 0 0 0-8 0v1H5a1 1 0 0 0-1 1v11a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8a1 1 0 0 0-1-1zM10 6a2 2 0 0 1 4 0v1h-4V6zm8 13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V9h2v1a1 1 0 0 0 2 0V9h4v1a1 1 0 0 0 2 0V9h2v10z"/>
                    </svg>
                </div>
                <div class="order-number">
                    Order #<span th:text="${order.id}">001</span>
                </div>
            </div>

            <!-- Info -->
            <div class="info-section">
                <h2 class="order-title">Chi tiết order</h2>

                <div class="status-badge" th:class="'status-badge ' + ${order.status.toLowerCase()}">
                    <span th:text="${order.status}">Pending</span>
                </div>

                <div class="info-grid">
                    <div class="info-item">
                        <label>Order ID:</label>
                        <span th:text="${order.id}">001</span>
                    </div>
                    <div class="info-item">
                        <label>Ngày đặt thuê:</label>
                        <span th:text="${order.orderDate}">2024-01-15</span>
                    </div>
                    <div class="info-item">
                        <label>Ngày bắt đầu thuê:</label>
                        <span th:text="${order.startDate}">2024-01-20</span>
                    </div>
                    <div class="info-item">
                        <label>Ngày kết thúc thuê:</label>
                        <span th:text="${order.endDate}">2024-01-30</span>
                    </div>
                    <div class="info-item price-item">
                        <label>Tổng tiền:</label>
                        <span class="price" th:text="${order.totalAmount} + ' VND'">500,000 VND</span>
                    </div>
                </div>

                <div class="customer-info">
                    <label>Thông tin khách hàng:</label>
                    <p th:text="${order.customer.fullname}">Nguyễn Văn A</p>
                </div>

                <!-- Actions -->
                <div class="action-buttons">
                    <!-- Approve/Reject only when PENDING (both MANAGER & STAFF) -->
                    <div th:if="${#strings.equalsIgnoreCase(order.status,'PENDING')}" sec:authorize="hasAnyAuthority('MANAGER','STAFF')">
                        <form th:action="@{${b} + '/orders/' + ${order.id} + '/approve'}" method="post" style="display:inline;">
                            <button type="submit" class="approve-btn">✓ Phê duyệt</button>
                        </form>
                        <form th:action="@{${b} + '/orders/' + ${order.id} + '/reject'}" method="post" style="display:inline;">
                            <button type="submit" class="reject-btn">✗ Từ chối</button>
                        </form>
                    </div>

                    <div th:if="${#strings.equalsIgnoreCase(order.status,'REJECTED')}" style="font-weight:600;color:#c82333;padding:12px 0;">
                        Order này đã bị từ chối
                    </div>
                    <div th:if="${#strings.equalsIgnoreCase(order.status,'PAID')}" style="font-weight:600;color:#20c997;padding:12px 0;">
                        Order này đã được thanh toán
                    </div>
                    <div th:if="${#strings.equalsIgnoreCase(order.status,'APPROVED')}" style="font-weight:600;color:#007bff;padding:12px 0;">
                        Order này cần được thanh toán
                    </div>

                    <div style="width:100%;margin-top:20px;">
                        <a th:href="@{${b} + '/orders'}" class="back-btn">Quay lại danh sách</a>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- /th:with -->
</div>

</body>
</html>
